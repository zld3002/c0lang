#!/bin/sh
#
# simple config script for system-dependent build options
#

# Download any dependencies such as libbacktrace
git submodule update --init

# configure qmake to build a Makefile on a mac instead of an Xcode project
case `uname -s` in
    Darwin)
      PLATFORM=osx
      DLLSUFFIX=.dylib
      EXTERNALS=libpng
      ;;
    CYGWIN*)
      PLATFORM=cygwin
      DLLSUFFIX=.dll
      EXTERNALS=gc
      ;;
    *)
      PLATFORM=linux
      DLLSUFFIX=.so
      EXTERNALS=
      ;;
esac

MACHINE=x86
case `uname -m` in
i*86) MACHINE=x86; ;;
x86_64) MACHINE=amd64; ;;
*) echo "Unknown machine type! Assuming x86..." ;;
esac

DIR=`dirname $0`

# write to config.mk
echo "Writing config.mk ..."
cat >$DIR/config.mk <<EOF
########################################################
### automatically generated by $0
### (probably best not to edit by hand..)

PLATFORM = $PLATFORM
DLLSUFFIX = $DLLSUFFIX
MACHINE = $MACHINE
EXTERNALS = $EXTERNALS

ifeq (\$(PLATFORM),cygwin)
STATIC=1
endif
EOF
