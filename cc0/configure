#!/bin/sh
#
# simple config script for system-dependent build options
#

# Download any dependencies such as libbacktrace
git submodule update --init

# configure qmake to build a Makefile on a mac instead of an Xcode project
case `uname -s` in
    Darwin)
      PLATFORM=osx
      DLLSUFFIX=.dylib
      EXTERNALS=
      ;;
    CYGWIN*)
      echo "Cygwin is no longer supported! Please use WSL instead"
      echo "https://docs.microsoft.com/en-us/windows/wsl/install-win10"
      exit 1
      ;;
    *)
      PLATFORM=linux
      DLLSUFFIX=.so
      EXTERNALS=
      ;;
esac

MACHINE=amd64
case `uname -m` in
i*86) MACHINE=x86; ;;
x86_64) MACHINE=amd64; ;;
arm64) MACHINE=arm64 ;;
*) echo "Unknown machine type! Assuming amd64..." ;;
esac

DIR=`dirname $0`

# write to config.mk
echo "Writing config.mk ..."
cat >$DIR/config.mk <<EOF
########################################################
### automatically generated by $0
### (probably best not to edit by hand..)

PLATFORM = $PLATFORM
DLLSUFFIX = $DLLSUFFIX
MACHINE = $MACHINE
EXTERNALS = $EXTERNALS
EOF
